# 반복 일정 기능 - 제품 요구사항 명세서 (PRD)

> **작성일**: 2025-10-29  
> **버전**: 1.0  
> **담당**: Product Team  
> **우선순위**: Critical

---

## 목차

1. [개요](#개요)
2. [기능 요구사항](#기능-요구사항)
3. [비기능 요구사항](#비기능-요구사항)
4. [제약사항](#제약사항)
5. [용어 정의](#용어-정의)

---

## 개요

### 목적

사용자가 반복되는 일정(매일, 매주, 매월, 매년)을 효율적으로 생성하고 관리할 수 있도록 한다.

### 범위

- 반복 일정 생성 및 수정
- 반복 일정 시각적 표시
- 반복 일정 종료 조건 설정
- 단일/전체 수정 및 삭제

---

## 기능 요구사항

### REQ-001: 반복 유형 선택

#### 기본 동작

일정 생성 또는 수정 시 반복 유형을 선택할 수 있다.

#### 지원 반복 유형

- **`반복 안 함`** (None) - 단일 일정 (1회성)
- `매일` (Daily) - 매일 반복
- `매주` (Weekly) - 매주 반복
- `매월` (Monthly) - 매월 반복
- `매년` (Yearly) - 매년 반복

> **참고**: `반복 안 함`은 반복하지 않는 단일 일정을 의미하며, 시스템 내부적으로 `type: 'none'`으로 표현됩니다.

**우선순위**: Critical  
**관련 UI**: 일정 생성/수정 폼

---

### REQ-002: 매월 반복 - 31일 처리

#### 규칙

31일에 "매월" 반복을 선택하면 **31일이 있는 달에만** 일정을 생성한다.

#### 상세 동작

- ✅ **생성되는 달**: 1월, 3월, 5월, 7월, 8월, 10월, 12월
- ❌ **건너뛰는 달**: 2월, 4월, 6월, 9월, 11월

#### 예시

```
시작일: 2025-01-31
반복: 매월
결과:
  - 2025-01-31 ✅
  - 2025-02-31 ❌ (2월은 28/29일까지)
  - 2025-03-31 ✅
  - 2025-04-31 ❌ (4월은 30일까지)
  - 2025-05-31 ✅
  ...
```

**우선순위**: Critical  
**Edge Case**: EDGE-001

---

### REQ-003: 매년 반복 - 윤년 29일 처리

#### 규칙

2월 29일에 "매년" 반복을 선택하면 **윤년에만** 일정을 생성한다.

#### 상세 동작

- ✅ **생성되는 해**: 윤년 (2024, 2028, 2032, ...)
- ❌ **건너뛰는 해**: 평년 (2025, 2026, 2027, ...)

#### 윤년 판정 규칙

```
윤년 = (연도 % 4 == 0) AND (연도 % 100 != 0) OR (연도 % 400 == 0)
```

#### 예시

```
시작일: 2024-02-29
반복: 매년
결과:
  - 2024-02-29 ✅ (윤년)
  - 2025-02-29 ❌ (평년)
  - 2026-02-29 ❌ (평년)
  - 2027-02-29 ❌ (평년)
  - 2028-02-29 ✅ (윤년)
  ...
```

**우선순위**: Critical  
**Edge Case**: EDGE-002

---

### REQ-004: 반복 일정 겹침 미고려

#### 규칙

반복 일정 생성 시 기존 일정과의 겹침을 검사하지 않는다.

#### 상세 동작

- 같은 시간대에 여러 일정이 생성될 수 있다.
- 중복 검증을 하지 않는다.
- 사용자가 수동으로 관리한다.

**우선순위**: Critical  
**제약사항**: CONS-001

---

### REQ-005: 반복 일정 시각적 표시

#### 기본 동작

캘린더 뷰에서 반복 일정을 아이콘으로 구분하여 표시한다.

#### UI 요구사항

- 반복 일정에는 반복 아이콘(🔁 또는 ⟳)을 표시한다.
- 단일 일정과 명확히 구분된다.
- 아이콘은 일정 제목 옆에 표시된다.

#### 예시

```
일반 일정:  "회의"
반복 일정:  "회의 🔁"
```

**우선순위**: High  
**관련 UI**: 캘린더 뷰, 월/주/일 뷰

---

### REQ-006: 반복 종료 조건

#### 기본 동작

반복 일정의 종료 조건을 지정할 수 있다.

#### 지원 옵션

- **특정 날짜까지**: 사용자가 지정한 날짜까지만 반복

#### 제한사항

- 최대 종료 날짜: `2025-12-31`
- 이 날짜 이후로는 일정이 생성되지 않는다.

#### 예시

```
시작일: 2025-01-01
반복: 매주
종료: 2025-12-31

결과: 2025-01-01 ~ 2025-12-31 사이의 매주 수요일에만 생성
```

**우선순위**: Critical  
**제약사항**: CONS-002

---

### REQ-007: 반복 일정 수정 - 단일 수정

#### 트리거

"해당 일정만 수정하시겠어요?" 다이얼로그에서 **"예"** 선택 시

#### 동작

1. 선택한 일정만 수정된다.
2. 해당 일정은 **반복 일정에서 단일 일정으로 변경**된다.
3. 반복 일정 아이콘(🔁)이 사라진다.
4. 다른 반복 일정은 영향받지 않는다.

#### 예시

```
원본 반복 일정:
  - 2025-01-01 "회의 🔁"
  - 2025-01-08 "회의 🔁"
  - 2025-01-15 "회의 🔁"

1월 8일 일정을 "중요 회의"로 단일 수정:
  - 2025-01-01 "회의 🔁"        (변경 없음)
  - 2025-01-08 "중요 회의"      (단일 일정으로 변경, 아이콘 제거)
  - 2025-01-15 "회의 🔁"        (변경 없음)
```

**우선순위**: Critical  
**관련 UI**: 일정 수정 다이얼로그

---

### REQ-008: 반복 일정 수정 - 전체 수정

#### 트리거

"해당 일정만 수정하시겠어요?" 다이얼로그에서 **"아니오"** 선택 시

#### 동작

1. 반복 일정의 **모든 일정이 수정**된다.
2. 반복 일정 속성은 **유지**된다.
3. 반복 일정 아이콘(🔁)이 **유지**된다.

#### 예시

```
원본 반복 일정:
  - 2025-01-01 "회의 🔁"
  - 2025-01-08 "회의 🔁"
  - 2025-01-15 "회의 🔁"

전체 수정으로 "팀 회의"로 변경:
  - 2025-01-01 "팀 회의 🔁"
  - 2025-01-08 "팀 회의 🔁"
  - 2025-01-15 "팀 회의 🔁"
```

**우선순위**: Critical  
**관련 UI**: 일정 수정 다이얼로그

---

### REQ-009: 반복 일정 삭제 - 단일 삭제

#### 트리거

"해당 일정만 삭제하시겠어요?" 다이얼로그에서 **"예"** 선택 시

#### 동작

1. 선택한 일정만 삭제된다.
2. 다른 반복 일정은 영향받지 않는다.
3. 반복 패턴은 유지된다.

#### 예시

```
원본 반복 일정:
  - 2025-01-01 "회의 🔁"
  - 2025-01-08 "회의 🔁"
  - 2025-01-15 "회의 🔁"

1월 8일 일정을 단일 삭제:
  - 2025-01-01 "회의 🔁"
  - 2025-01-08 (삭제됨)
  - 2025-01-15 "회의 🔁"
```

**우선순위**: Critical  
**관련 UI**: 일정 삭제 다이얼로그

---

### REQ-010: 반복 일정 삭제 - 전체 삭제

#### 트리거

"해당 일정만 삭제하시겠어요?" 다이얼로그에서 **"아니오"** 선택 시

#### 동작

1. 반복 일정의 **모든 일정이 삭제**된다.
2. 반복 그룹 자체가 삭제된다.

#### 예시

```
원본 반복 일정:
  - 2025-01-01 "회의 🔁"
  - 2025-01-08 "회의 🔁"
  - 2025-01-15 "회의 🔁"

전체 삭제:
  - 2025-01-01 (삭제됨)
  - 2025-01-08 (삭제됨)
  - 2025-01-15 (삭제됨)
```

**우선순위**: Critical  
**관련 UI**: 일정 삭제 다이얼로그

---

## 비기능 요구사항

### NFR-001: 성능

- 반복 일정 생성은 1초 이내에 완료되어야 한다.
- 최대 365개의 반복 일정을 생성할 수 있어야 한다.

### NFR-002: 사용성

- 다이얼로그는 명확한 질문으로 사용자 의도를 확인한다.
- "예"/"아니오" 버튼은 시각적으로 명확히 구분된다.

### NFR-003: 접근성

- 다이얼로그는 키보드로 조작 가능해야 한다.
- 반복 아이콘은 스크린 리더에서 "반복 일정"으로 읽혀야 한다.

---

## 제약사항

### CONS-001: 반복 일정 겹침

반복 일정은 기존 일정과의 겹침을 검사하지 않는다. 사용자가 수동으로 관리해야 한다.

### CONS-002: 최대 종료 날짜

반복 일정의 최대 종료 날짜는 `2025-12-31`로 제한된다.

### CONS-003: 타임존

현재 버전에서는 타임존을 고려하지 않는다. 로컬 타임존으로 동작한다.

---

## 용어 정의

| 용어           | 정의                                                    |
| -------------- | ------------------------------------------------------- |
| 반복 일정      | 매일, 매주, 매월, 매년 등의 패턴으로 자동 생성되는 일정 |
| 단일 일정      | 반복되지 않는 1회성 일정 (type: 'none')                 |
| 반복 유형      | 반복 안 함(none), 매일(daily), 매주(weekly), 매월(monthly), 매년(yearly) 중 하나 |
| 단일 수정/삭제 | 반복 일정 중 선택한 1개만 수정/삭제                     |
| 전체 수정/삭제 | 반복 일정의 모든 인스턴스를 수정/삭제                   |
| 윤년           | 2월 29일이 있는 해 (4년마다, 100년 제외, 400년 포함)    |

---

## Edge Cases

### EDGE-001: 31일 매월 반복

- **시나리오**: 31일에 매월 반복 선택
- **동작**: 31일이 없는 달(2, 4, 6, 9, 11월)은 건너뜀
- **테스트 필요**: 1년 전체 생성 확인

### EDGE-002: 2월 29일 매년 반복

- **시나리오**: 2월 29일에 매년 반복 선택
- **동작**: 윤년에만 생성 (4년 주기)
- **테스트 필요**: 10년 이상 생성 확인

### EDGE-003: 단일 수정 후 다시 반복으로 변경

- **시나리오**: 단일 수정된 일정을 다시 반복으로 만들 수 있는가?
- **현재 명세**: 불명확 → **사용자 확인 필요**

### EDGE-004: 종료 날짜가 시작 날짜보다 이전

- **시나리오**: 종료 날짜 < 시작 날짜
- **현재 명세**: 불명확 → **사용자 확인 필요**

---

## UI/UX 요구사항

### UI-001: 반복 선택 UI

- 드롭다운 또는 라디오 버튼으로 반복 유형 선택
- 옵션: "반복 안 함", "매일", "매주", "매월", "매년"

### UI-002: 반복 아이콘

- 아이콘: 🔁 또는 ⟳
- 위치: 일정 제목 옆
- 색상: 테마에 맞게 조정 가능

### UI-003: 수정/삭제 다이얼로그

```
┌─────────────────────────────────────┐
│  해당 일정만 수정하시겠어요?        │
│                                     │
│  [예]  [아니오]                     │
└─────────────────────────────────────┘
```

---

## 데이터 구조

### Event 객체 (반복 일정 포함)

```typescript
// 반복 유형
type RepeatType = 'none' | 'daily' | 'weekly' | 'monthly' | 'yearly';

// 반복 정보
interface RepeatInfo {
  type: RepeatType;        // 반복 유형
  interval: number;        // 반복 간격 (1 = 매일/매주/매월/매년)
  endDate?: string;        // 반복 종료일 (최대 2025-12-31)
}

// 일정 폼 데이터
interface EventForm {
  title: string;           // 일정 제목
  date: string;            // 일정 날짜 (ISO 8601)
  startTime: string;       // 시작 시간 (HH:mm)
  endTime: string;         // 종료 시간 (HH:mm)
  description: string;     // 일정 설명
  location: string;        // 장소
  category: string;        // 카테고리
  repeat: RepeatInfo;      // 반복 정보
  notificationTime: number; // 알림 시간 (분 단위)
}

// 저장된 일정 (ID 포함)
interface Event extends EventForm {
  id: string;              // 일정 고유 ID
}
```

> **참고**: 
> - `repeat.type === 'none'`인 경우 단일 일정 (반복 안 함)
> - `repeat.type !== 'none'`인 경우 반복 일정
> - `repeat.interval`은 현재 1로 고정 (향후 확장 가능)

---

## 우선순위 요약

| 우선순위 | 요구사항 ID | 설명             |
| -------- | ----------- | ---------------- |
| Critical | REQ-001     | 반복 유형 선택 (None/Daily/Weekly/Monthly/Yearly) |
| Critical | REQ-002     | 매월 31일 처리   |
| Critical | REQ-003     | 매년 윤년 처리   |
| Critical | REQ-004     | 일정 겹침 미고려 |
| High     | REQ-005     | 반복 아이콘 표시 |
| Critical | REQ-006     | 반복 종료 조건   |
| Critical | REQ-007     | 단일 수정        |
| Critical | REQ-008     | 전체 수정        |
| Critical | REQ-009     | 단일 삭제        |
| Critical | REQ-010     | 전체 삭제        |

---

## 불명확한 항목 (구현 전 확인 필요)

| 항목                  | 질문                                               | 제안                      |
| --------------------- | -------------------------------------------------- | ------------------------- |
| 매주 반복 요일 선택   | 매주 반복 시 특정 요일을 선택할 수 있는가?         | 명세에 없으면 월요일 고정 |
| 단일 수정 후 재반복화 | 단일로 변경된 일정을 다시 반복으로 만들 수 있는가? | 불가능하다고 가정         |
| 종료 날짜 검증        | 종료 날짜가 시작 날짜보다 이전이면?                | 에러 처리 필요            |
| 최소 반복 횟수        | 반복 일정은 최소 2개 이상 생성되어야 하는가?       | 제한 없음으로 가정        |

---
