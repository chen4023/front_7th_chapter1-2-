# REQ-002: 매월 반복 - 31일 처리 - 테스트 설계

> **작성일**: 2025-01-30
> **명세 문서**: docs/specification.md (REQ-002)
> **설계자**: Test Planner Agent
> **우선순위**: Critical
> **Edge Case ID**: EDGE-001
> **버전**: 1.0

---

## 📊 Executive Summary

### 핵심 통계

- **총 TODO 항목**: 22개
- **예상 작업 시간**: 4시간 15분
- **명세 커버리지**: 100%
- **Critical 항목**: 14개 (2시간 50분)
- **High 항목**: 6개 (1시간 5분)
- **Medium 항목**: 2개 (20분)
- **Edge Case 항목**: 8개 (1시간 30분)

### 주요 결정사항

1. **간단한 달부터 시작**: 15일 매월 반복 (모든 달 가능) → 31일 매월 반복 (Edge Case)
2. **월별 검증 전략**: 31일 있는 달 7개 (1, 3, 5, 7, 8, 10, 12월) 우선 → 건너뛰는 달 5개 (2, 4, 6, 9, 11월) 검증
3. **윤년 고려**: 2월의 경우 윤년(29일)과 평년(28일) 모두 31일 없음 → 항상 건너뛰기
4. **종료일 제약**: 최대 2025-12-31까지만 생성
5. **성능 제약**: 365개 반복 일정, 1초 이내 생성 확인

### 범위 정의

#### ✅ In Scope (REQ-002 범위 내)

- 31일에 시작하는 매월 반복 일정 생성
- 31일이 있는 달(1, 3, 5, 7, 8, 10, 12월)에만 생성
- 31일이 없는 달(2, 4, 6, 9, 11월) 건너뛰기
- 2025-12-31 종료일 제약
- 윤년/평년 모두에서 2월 건너뛰기

#### ❌ Out of Scope (다른 REQ)

- 반복 유형 선택 UI (REQ-001)
- 반복 아이콘 표시 (REQ-005)
- 반복 종료 조건 설정 UI (REQ-006)
- 단일/전체 수정 (REQ-007, REQ-008)
- 단일/전체 삭제 (REQ-009, REQ-010)
- 윤년 2월 29일 매년 반복 (REQ-003)

---

## 명세 분석 결과

### REQ-002 핵심 요구사항

#### 1. 규칙

**31일에 "매월" 반복을 선택하면 31일이 있는 달에만 일정을 생성한다**

#### 2. 상세 동작

- ✅ **생성되는 달**: 1월(Jan), 3월(Mar), 5월(May), 7월(Jul), 8월(Aug), 10월(Oct), 12월(Dec) - 총 7개월
- ❌ **건너뛰는 달**: 2월(Feb), 4월(Apr), 6월(Jun), 9월(Sep), 11월(Nov) - 총 5개월

#### 3. 예시 (명세에서 인용)

```
시작일: 2025-01-31
반복: 매월
결과:
  - 2025-01-31 ✅
  - 2025-02-31 ❌ (2월은 28/29일까지)
  - 2025-03-31 ✅
  - 2025-04-31 ❌ (4월은 30일까지)
  - 2025-05-31 ✅
  ...
```

#### 4. 관련 제약사항

- **CONS-002**: 최대 종료일은 2025-12-31
- **CONS-001**: 반복 일정 겹침은 검사하지 않음
- **NFR-001**: 성능 - 1초 이내 완료, 최대 365개 생성 가능

#### 5. 데이터 구조

```typescript
// types.ts
export type RepeatType = 'none' | 'daily' | 'weekly' | 'monthly' | 'yearly';

export interface RepeatInfo {
  type: RepeatType;        // 'monthly'
  interval: number;        // 1 (매월)
  endDate?: string;        // 'YYYY-MM-DD' 형식, 최대 '2025-12-31'
}

export interface EventForm {
  title: string;
  date: string;            // '2025-01-31' (시작일)
  startTime: string;
  endTime: string;
  description: string;
  location: string;
  category: string;
  repeat: RepeatInfo;
  notificationTime: number;
}

export interface Event extends EventForm {
  id: string;
}
```

#### 6. 월별 일수 참조표

| 달 | 1월 | 2월 | 3월 | 4월 | 5월 | 6월 | 7월 | 8월 | 9월 | 10월 | 11월 | 12월 |
|----|-----|-----|-----|-----|-----|-----|-----|-----|-----|------|------|------|
| 일수 (평년) | 31 | 28 | 31 | 30 | 31 | 30 | 31 | 31 | 30 | 31 | 30 | 31 |
| 일수 (윤년) | 31 | 29 | 31 | 30 | 31 | 30 | 31 | 31 | 30 | 31 | 30 | 31 |
| 31일 생성 | ✅ | ❌ | ✅ | ❌ | ✅ | ❌ | ✅ | ✅ | ❌ | ✅ | ❌ | ✅ |

---

## ⚠️ 불명확한 항목 (구현 전 확인 필요)

| 항목 | 명세 참조 | 질문 | 제안 | 상태 |
|------|----------|------|------|------|
| 30일 매월 반복 | - | 30일에 매월 반복 시 2월은 건너뛰나요? | 건너뛴다고 가정 (REQ-002 범위 아님, 추후 확인) | ⏳ 대기 중 |
| 29일 매월 반복 평년 2월 | - | 29일에 매월 반복 시 평년 2월은 건너뛰나요? | 건너뛴다고 가정 (REQ-002 범위 아님, 추후 확인) | ⏳ 대기 중 |
| 반복 일정 최소 개수 | - | 반복 일정이 1개만 생성될 수 있나요? (예: 2025-12-31 시작, 종료일 없음) | 가능하다고 가정 | ⏳ 대기 중 |
| 종료일 = 시작일 | - | 종료일과 시작일이 같으면 어떻게 되나요? | 에러 또는 1개 생성 (추후 확인) | ⏳ 대기 중 |

> 💡 **Action**: 위 항목은 REQ-002의 범위를 벗어나므로, 사용자 확인 후 필요시 별도 TODO로 관리합니다.

---

## TODO List

### Kent Beck 방식: 간단한 것부터 복잡한 순서

```
Level 1: 기본 동작 (Happy Path)
  ↓
Level 2: 31일이 있는 달 (Edge Case 준비)
  ↓
Level 3: 31일이 없는 달 건너뛰기 (Core Edge Case)
  ↓
Level 4: 통합 검증 (1년 전체, 성능)
  ↓
Level 5: 경계값 및 제약사항
```

---

### 🎯 Critical: 기본 동작 (10개 항목, 1시간 50분)

#### TODO-001: 매월 반복 기본 로직 검증 (15분)

**목표**: 31일이 아닌 날짜로 매월 반복이 정상 작동하는지 확인

- **Given**: 시작일 2025-01-15 (모든 달에 15일이 있음)
- **When**: 매월 반복 선택, 종료일 2025-04-15
- **Then**: 2025-01-15, 2025-02-15, 2025-03-15, 2025-04-15 총 4개 생성

**검증 항목**:
- 생성된 이벤트 개수 = 4
- 각 날짜의 일(day)이 모두 15
- 월(month)이 1, 2, 3, 4로 증가
- 모든 이벤트의 title, startTime, endTime, description, location, category, notificationTime이 동일

**명세 참조**: REQ-002 (기본 매월 반복 동작)

---

#### TODO-002: 31일 매월 반복 - 1월 시작 3개월 (15분)

**목표**: 31일 시작 매월 반복이 31일 있는 달에만 생성됨을 확인 (가장 간단한 31일 케이스)

- **Given**: 시작일 2025-01-31
- **When**: 매월 반복 선택, 종료일 2025-05-31
- **Then**: 2025-01-31, 2025-03-31, 2025-05-31 총 3개 생성 (2월, 4월 건너뜀)

**검증 항목**:
- 생성된 이벤트 개수 = 3 (5개월 기간이지만 3개만 생성)
- 생성된 날짜: 2025-01-31, 2025-03-31, 2025-05-31
- **생성되지 않은 날짜**: 2025-02-31 (2월 28일까지), 2025-04-31 (4월 30일까지)
- 모든 이벤트의 일(day)이 31

**명세 참조**: REQ-002, EDGE-001

---

#### TODO-003: 31일 매월 반복 - 1월 단독 (10분)

**목표**: 31일 시작 후 즉시 건너뛰는 케이스 (2월)

- **Given**: 시작일 2025-01-31
- **When**: 매월 반복 선택, 종료일 2025-02-28
- **Then**: 2025-01-31만 생성 (2월 건너뜀)

**검증 항목**:
- 생성된 이벤트 개수 = 1
- 유일한 이벤트 날짜 = 2025-01-31
- 2025-02-31이 생성되지 않음

**명세 참조**: REQ-002, EDGE-001

---

#### TODO-004: 31일 매월 반복 - 2월 건너뛰기 명시 확인 (10분)

**목표**: 2월을 명시적으로 건너뛰는지 확인

- **Given**: 시작일 2025-01-31
- **When**: 매월 반복 선택, 종료일 2025-03-31
- **Then**: 2025-01-31, 2025-03-31 생성 (2월 건너뜀)

**검증 항목**:
- 생성된 이벤트 개수 = 2
- 2025-02-31이 생성되지 않음 (2월은 28일까지)
- 2025-02-28이 생성되지 않음 (대체 생성 없음)

**명세 참조**: REQ-002, EDGE-001 - "2월은 28/29일까지"

---

#### TODO-005: 31일 매월 반복 - 31일 있는 모든 달 생성 확인 (20분)

**목표**: 31일이 있는 7개 달 모두에서 생성되는지 확인

- **Given**: 시작일 2025-01-31
- **When**: 매월 반복 선택, 종료일 2025-12-31
- **Then**: 2025년 1, 3, 5, 7, 8, 10, 12월 31일 총 7개 생성

**검증 항목**:
- 생성된 이벤트 개수 = 7
- 생성된 날짜:
  - 2025-01-31 ✅
  - 2025-03-31 ✅
  - 2025-05-31 ✅
  - 2025-07-31 ✅
  - 2025-08-31 ✅
  - 2025-10-31 ✅
  - 2025-12-31 ✅
- 모든 날짜의 일(day) = 31
- 월(month) = 1, 3, 5, 7, 8, 10, 12

**명세 참조**: REQ-002 - "1월, 3월, 5월, 7월, 8월, 10월, 12월"

---

#### TODO-006: 31일 매월 반복 - 30일 달 건너뛰기 확인 (15분)

**목표**: 30일까지 있는 달(4, 6, 9, 11월)을 건너뛰는지 확인

- **Given**: 시작일 2025-03-31
- **When**: 매월 반복 선택, 종료일 2025-07-31
- **Then**: 2025-03-31, 2025-05-31, 2025-07-31 생성 (4월, 6월 건너뜀)

**검증 항목**:
- 생성된 이벤트 개수 = 3
- 생성된 날짜: 2025-03-31, 2025-05-31, 2025-07-31
- **생성되지 않은 날짜**:
  - 2025-04-31 (4월은 30일까지)
  - 2025-06-31 (6월은 30일까지)
- 2025-04-30이 생성되지 않음 (대체 생성 없음)
- 2025-06-30이 생성되지 않음 (대체 생성 없음)

**명세 참조**: REQ-002, EDGE-001 - "4월은 30일까지"

---

#### TODO-007: 31일 매월 반복 - 모든 건너뛰는 달 검증 (15분)

**목표**: 31일 없는 5개 달 모두 건너뛰는지 확인

- **Given**: 시작일 2025-01-31
- **When**: 매월 반복 선택, 종료일 2025-12-31
- **Then**: 2월, 4월, 6월, 9월, 11월에는 생성 안 됨

**검증 항목**:
- 다음 날짜들이 **생성되지 않음**:
  - 2025-02-31 ❌ (2월 28일까지)
  - 2025-04-31 ❌ (4월 30일까지)
  - 2025-06-31 ❌ (6월 30일까지)
  - 2025-09-31 ❌ (9월 30일까지)
  - 2025-11-31 ❌ (11월 30일까지)
- 대체 날짜(28일, 30일)도 생성되지 않음

**명세 참조**: REQ-002, EDGE-001 - "2월, 4월, 6월, 9월, 11월"

---

#### TODO-008: 31일 매월 반복 - 연속된 건너뛰기 (4-6월) (10분)

**목표**: 연속으로 2개월을 건너뛰는 경우 (4월, 6월)

- **Given**: 시작일 2025-03-31
- **When**: 매월 반복 선택, 종료일 2025-07-31
- **Then**: 2025-03-31, 2025-05-31, 2025-07-31 생성 (4월, 6월 연속 건너뛰기)

**검증 항목**:
- 생성된 이벤트 개수 = 3
- 3월 → 5월 (4월 건너뜀)
- 5월 → 7월 (6월 건너뜀)
- 생성되지 않은 날짜: 2025-04-31, 2025-06-31

**명세 참조**: REQ-002, EDGE-001

---

#### TODO-009: 31일 매월 반복 - 생성된 이벤트 데이터 무결성 검증 (10분)

**목표**: 생성된 모든 반복 이벤트가 원본 이벤트의 속성을 유지하는지 확인

- **Given**:
  - 시작일 2025-01-31
  - 제목 "월말 보고"
  - 시간 09:00-10:00
  - 설명 "매월 말일 보고서 제출"
  - 위치 "본사"
  - 카테고리 "업무"
  - 알림 10분 전
- **When**: 매월 반복 선택, 종료일 2025-05-31
- **Then**: 생성된 3개 이벤트(1월, 3월, 5월) 모두 동일한 속성

**검증 항목**:
- 모든 이벤트의 title = "월말 보고"
- 모든 이벤트의 startTime = "09:00"
- 모든 이벤트의 endTime = "10:00"
- 모든 이벤트의 description = "매월 말일 보고서 제출"
- 모든 이벤트의 location = "본사"
- 모든 이벤트의 category = "업무"
- 모든 이벤트의 notificationTime = 10
- 모든 이벤트의 repeat.type = 'monthly'
- 모든 이벤트의 repeat.interval = 1
- 각 이벤트는 고유한 id를 가짐

**명세 참조**: 데이터 구조 (specification.md)

---

#### TODO-010: 31일 매월 반복 - 반복 정보 유지 확인 (10분)

**목표**: 생성된 각 반복 이벤트가 반복 정보를 유지하는지 확인

- **Given**: 시작일 2025-01-31, 매월 반복
- **When**: 종료일 2025-05-31로 생성
- **Then**: 생성된 각 이벤트의 repeat 정보 확인

**검증 항목**:
- 각 이벤트의 repeat.type = 'monthly'
- 각 이벤트의 repeat.interval = 1
- 각 이벤트의 repeat.endDate = '2025-05-31'
- 각 이벤트가 반복 일정임을 식별 가능

**명세 참조**: 데이터 구조, REQ-005 (반복 아이콘 표시 준비)

---

### 🔥 High: Edge Case 심화 (6개 항목, 1시간 5분)

#### TODO-011: 31일 매월 반복 - 윤년 2월 건너뛰기 (2024년) (15분)

**목표**: 윤년(2월 29일)에도 31일 매월 반복이 2월을 건너뛰는지 확인

- **Given**: 시작일 2024-01-31 (2024년은 윤년)
- **When**: 매월 반복 선택, 종료일 2024-03-31
- **Then**: 2024-01-31, 2024-03-31 생성 (윤년 2월도 건너뜀)

**검증 항목**:
- 생성된 이벤트 개수 = 2
- 2024-02-31이 생성되지 않음 (윤년이어도 2월은 29일까지)
- 2024-02-29가 생성되지 않음 (대체 생성 없음)

**명세 참조**: REQ-002, EDGE-001 - "2월은 28/29일까지"

---

#### TODO-012: 31일 매월 반복 - 평년 2월 건너뛰기 (2025년) (10분)

**목표**: 평년(2월 28일)에 31일 매월 반복이 2월을 건너뛰는지 확인

- **Given**: 시작일 2025-01-31 (2025년은 평년)
- **When**: 매월 반복 선택, 종료일 2025-03-31
- **Then**: 2025-01-31, 2025-03-31 생성 (평년 2월 건너뜀)

**검증 항목**:
- 생성된 이벤트 개수 = 2
- 2025-02-31이 생성되지 않음
- 2025-02-28이 생성되지 않음 (대체 생성 없음)

**명세 참조**: REQ-002, EDGE-001

---

#### TODO-013: 31일 매월 반복 - 연말 경계 (12월 → 다음해 1월) (15분)

**목표**: 연도가 바뀌는 경우 처리 (12월 31일 → 1월 31일)

- **Given**: 시작일 2024-12-31
- **When**: 매월 반복 선택, 종료일 2025-03-31
- **Then**: 2024-12-31, 2025-01-31, 2025-03-31 생성 (2025년 2월 건너뜀)

**검증 항목**:
- 생성된 이벤트 개수 = 3
- 연도가 올바르게 증가: 2024 → 2025
- 2024-12-31 (2024년)
- 2025-01-31 (2025년 1월)
- 2025-03-31 (2025년 3월)
- 2025-02-31 생성 안 됨

**명세 참조**: REQ-002, EDGE-001

---

#### TODO-014: 31일 매월 반복 - 종료일이 31일 아닌 경우 (10분)

**목표**: 종료일이 31일이 아닌 경우에도 정상 동작하는지 확인

- **Given**: 시작일 2025-01-31
- **When**: 매월 반복 선택, 종료일 2025-06-15
- **Then**: 2025-01-31, 2025-03-31, 2025-05-31 생성 (6월 31일은 종료일 이후)

**검증 항목**:
- 생성된 이벤트 개수 = 3
- 마지막 이벤트 = 2025-05-31 (종료일 2025-06-15 이전)
- 2025-06-31은 생성 안 됨 (종료일 이후이자 6월은 30일까지)

**명세 참조**: REQ-002, REQ-006 (종료 조건)

---

#### TODO-015: 31일 매월 반복 - 시작일이 3월 31일 (10분)

**목표**: 1월이 아닌 다른 31일에서 시작하는 경우

- **Given**: 시작일 2025-03-31
- **When**: 매월 반복 선택, 종료일 2025-12-31
- **Then**: 3, 5, 7, 8, 10, 12월 31일 생성 (총 6개)

**검증 항목**:
- 생성된 이벤트 개수 = 6
- 생성 시작 = 2025-03-31
- 1월, 2월은 과거이므로 생성 안 됨
- 4, 6, 9, 11월 건너뛰기

**명세 참조**: REQ-002, EDGE-001

---

#### TODO-016: 31일 매월 반복 - 시작일이 8월 31일 (연속 31일 달) (5분)

**목표**: 7월(31일) → 8월(31일) 연속으로 31일 있는 경우

- **Given**: 시작일 2025-08-31
- **When**: 매월 반복 선택, 종료일 2025-12-31
- **Then**: 2025-08-31, 2025-10-31, 2025-12-31 생성 (9월, 11월 건너뜀)

**검증 항목**:
- 생성된 이벤트 개수 = 3
- 9월(30일), 11월(30일) 건너뛰기 확인

**명세 참조**: REQ-002, EDGE-001

---

### 🎨 Medium: 제약사항 및 통합 (2개 항목, 20분)

#### TODO-017: 31일 매월 반복 - 최대 종료일 2025-12-31 제약 (10분)

**목표**: 종료일이 2025-12-31을 넘지 않는지 확인

- **Given**: 시작일 2025-10-31
- **When**: 매월 반복 선택, 종료일 미지정 또는 2026-12-31 지정
- **Then**: 2025-12-31까지만 생성 (10월, 12월)

**검증 항목**:
- 생성된 이벤트 개수 = 2
- 마지막 이벤트 = 2025-12-31
- 2026년 이후 이벤트 생성 안 됨
- 11월(30일) 건너뛰기

**명세 참조**: CONS-002 - "최대 종료 날짜는 2025-12-31"

---

#### TODO-018: 31일 매월 반복 - 성능 검증 (1초 이내) (10분)

**목표**: 365개 반복 일정 생성이 1초 이내에 완료되는지 확인

- **Given**: 시작일 2025-01-31
- **When**: 매월 반복 선택, 종료일 2025-12-31 (최대 7개 생성)
- **Then**: 생성 시간 1초 이내

**검증 항목**:
- 생성 소요 시간 < 1000ms
- 생성된 이벤트 개수 = 7
- 모든 이벤트가 정상 생성됨

**명세 참조**: NFR-001 - "1초 이내에 완료되어야 한다"

**참고**: 31일 매월 반복은 최대 7개만 생성되므로, 이 테스트는 기본 성능 확인용. 실제 365개 테스트는 매일 반복(REQ-001)에서 수행.

---

### 🔬 High: 통합 및 경계값 (4개 항목, 40분)

#### TODO-019: 31일 매월 반복 - 1년 전체 통합 테스트 (15분)

**목표**: 2025년 전체(1월~12월) 동안 31일 매월 반복의 완전한 동작 확인

- **Given**: 시작일 2025-01-31
- **When**: 매월 반복 선택, 종료일 2025-12-31
- **Then**: 정확히 7개 이벤트 생성, 순서 확인

**검증 항목**:
- 생성된 이벤트 개수 = 7
- 생성 순서:
  1. 2025-01-31 (Jan)
  2. 2025-03-31 (Mar) - 2월 건너뜀
  3. 2025-05-31 (May) - 4월 건너뜀
  4. 2025-07-31 (Jul) - 6월 건너뜀
  5. 2025-08-31 (Aug)
  6. 2025-10-31 (Oct) - 9월 건너뜀
  7. 2025-12-31 (Dec) - 11월 건너뜀
- 건너뛴 달: 2, 4, 6, 9, 11월 (총 5개월)
- 각 이벤트의 날짜 간격이 올바름

**명세 참조**: REQ-002, EDGE-001 전체 검증

---

#### TODO-020: 31일 매월 반복 - 최소 생성 케이스 (단일 이벤트) (10분)

**목표**: 반복 일정이 1개만 생성되는 경우

- **Given**: 시작일 2025-12-31
- **When**: 매월 반복 선택, 종료일 미지정 또는 2025-12-31
- **Then**: 2025-12-31만 생성 (다음 31일은 2026-01-31로 범위 초과)

**검증 항목**:
- 생성된 이벤트 개수 = 1
- 유일한 이벤트 = 2025-12-31
- 다음 31일(2026-01-31)은 생성 안 됨 (최대 종료일 초과)

**명세 참조**: REQ-002, CONS-002

---

#### TODO-021: 31일 매월 반복 - 일정 겹침 미고려 확인 (10분)

**목표**: 반복 일정 생성 시 기존 일정과의 겹침을 검사하지 않는지 확인

- **Given**:
  - 기존 일정: 2025-03-31 10:00-11:00 "기존 회의"
  - 신규 반복 일정: 2025-01-31 시작, 매월 반복, 10:00-11:00 "새 회의"
- **When**: 신규 반복 일정 생성
- **Then**: 2025-03-31에 2개 일정 존재 (겹침 허용)

**검증 항목**:
- 2025-03-31 일정 개수 = 2
- 기존 일정 유지됨
- 신규 반복 일정 생성됨
- 겹침 경고 없음

**명세 참조**: REQ-004 - "반복 일정 겹침 미고려"

---

#### TODO-022: 31일 매월 반복 - 캘린더 UI 표시 확인 (5분)

**목표**: 생성된 31일 매월 반복 일정이 캘린더에 올바르게 표시되는지 확인

- **Given**: 시작일 2025-01-31, 매월 반복, 종료일 2025-05-31
- **When**: 캘린더 월 뷰 확인
- **Then**: 각 달의 31일에 이벤트 표시 (2월, 4월 제외)

**검증 항목**:
- 2025년 1월 캘린더: 31일에 이벤트 표시
- 2025년 2월 캘린더: 이벤트 없음
- 2025년 3월 캘린더: 31일에 이벤트 표시
- 2025년 4월 캘린더: 이벤트 없음
- 2025년 5월 캘린더: 31일에 이벤트 표시

**명세 참조**: REQ-002, UI 요구사항

---

## 테스트 우선순위 요약

| 우선순위 | TODO 범위 | 항목 수 | 예상 시간 | 설명 |
|---------|-----------|---------|-----------|------|
| **Critical** | TODO-001 ~ TODO-010 | 10개 | 1시간 50분 | 기본 동작, 31일 생성/건너뛰기 핵심 로직 |
| **High** | TODO-011 ~ TODO-016 | 6개 | 1시간 5분 | 윤년/평년, 연도 경계, 다양한 시작일 |
| **Medium** | TODO-017 ~ TODO-018 | 2개 | 20분 | 종료일 제약, 성능 검증 |
| **High** | TODO-019 ~ TODO-022 | 4개 | 40분 | 통합 테스트, 경계값, UI 확인 |
| **합계** | TODO-001 ~ TODO-022 | **22개** | **4시간 15분** | 전체 |

---

## Coverage Map (명세 → TODO 매핑)

### REQ-002: 매월 반복 - 31일 처리

| 명세 항목 | 설명 | 커버하는 TODO | 상태 |
|----------|------|--------------|------|
| **규칙** | 31일에 매월 반복 선택 시 31일 있는 달에만 생성 | TODO-002, TODO-005 | ✅ |
| **생성되는 달** | 1, 3, 5, 7, 8, 10, 12월 | TODO-005, TODO-019 | ✅ |
| **건너뛰는 달** | 2, 4, 6, 9, 11월 | TODO-007, TODO-019 | ✅ |
| **2월 처리** | 28/29일까지 → 건너뛰기 | TODO-004, TODO-011, TODO-012 | ✅ |
| **30일 달 처리** | 4, 6, 9, 11월 건너뛰기 | TODO-006, TODO-007 | ✅ |
| **기본 매월 반복** | 31일 아닌 날짜 정상 동작 | TODO-001 | ✅ |
| **데이터 무결성** | 원본 속성 유지 | TODO-009, TODO-010 | ✅ |

### EDGE-001: 31일 매월 반복 Edge Case

| Edge Case | 설명 | 커버하는 TODO | 상태 |
|-----------|------|--------------|------|
| **시나리오** | 31일에 매월 반복 선택 | TODO-002 ~ TODO-022 전체 | ✅ |
| **동작** | 31일 없는 달 건너뛰기 | TODO-003, TODO-006, TODO-007 | ✅ |
| **1년 전체** | 2025년 1월~12월 | TODO-019 | ✅ |
| **윤년 고려** | 2024년 2월 29일도 건너뛰기 | TODO-011 | ✅ |
| **연속 건너뛰기** | 4월, 6월 연속 | TODO-008 | ✅ |

### CONS-002: 최대 종료 날짜

| 제약사항 | 설명 | 커버하는 TODO | 상태 |
|---------|------|--------------|------|
| **최대 종료일** | 2025-12-31 | TODO-017, TODO-020 | ✅ |
| **범위 초과 방지** | 2026년 이후 생성 안 됨 | TODO-017 | ✅ |

### NFR-001: 성능

| 비기능 요구사항 | 설명 | 커버하는 TODO | 상태 |
|---------------|------|--------------|------|
| **생성 시간** | 1초 이내 | TODO-018 | ✅ |
| **최대 개수** | 365개 지원 | TODO-018 (참고) | ⚠️ 31일 반복은 최대 7개 |

### REQ-004: 반복 일정 겹침 미고려

| 관련 동작 | 설명 | 커버하는 TODO | 상태 |
|----------|------|--------------|------|
| **겹침 검사 없음** | 같은 시간대 중복 허용 | TODO-021 | ✅ |

### UI 요구사항

| UI 항목 | 설명 | 커버하는 TODO | 상태 |
|--------|------|--------------|------|
| **캘린더 표시** | 각 달의 31일에 표시 | TODO-022 | ✅ |

### 커버리지 통계

- **명세 커버리지**: 100% (REQ-002의 모든 요구사항 커버)
- **Edge Case 커버리지**: 100% (EDGE-001 전체 커버)
- **제약사항 커버리지**: 100% (CONS-002 커버)
- **통합 테스트**: 포함 (TODO-019, TODO-021, TODO-022)

---

## 권장 테스트 파일 구조

TODO 항목을 논리적 단위로 그룹화하여 테스트 파일을 구성합니다:

```
src/__tests__/
├── unit/
│   ├── monthlyRecurring31st.spec.ts
│   │   # TODO-001: 매월 반복 기본 로직 (15일 케이스)
│   │   # TODO-002: 31일 시작 3개월
│   │   # TODO-003: 31일 단독 생성
│   │   # TODO-004: 2월 건너뛰기 명시
│   │   # TODO-005: 31일 있는 7개 달 모두 생성
│   │   # TODO-006: 30일 달 건너뛰기
│   │   # TODO-007: 모든 건너뛰는 달 검증
│   │   # TODO-008: 연속 건너뛰기 (4-6월)
│   │   # TODO-009: 데이터 무결성
│   │   # TODO-010: 반복 정보 유지
│   │
│   └── monthlyRecurring31stEdgeCases.spec.ts
│       # TODO-011: 윤년 2월 (2024)
│       # TODO-012: 평년 2월 (2025)
│       # TODO-013: 연말 경계 (12월 → 1월)
│       # TODO-014: 종료일이 31일 아닌 경우
│       # TODO-015: 시작일이 3월 31일
│       # TODO-016: 시작일이 8월 31일
│
├── integration/
│   └── monthlyRecurring31stIntegration.spec.tsx
│       # TODO-019: 1년 전체 통합 테스트
│       # TODO-021: 일정 겹침 미고려 확인
│       # TODO-022: 캘린더 UI 표시 확인
│
└── performance/
    └── monthlyRecurringPerformance.spec.ts
        # TODO-017: 최대 종료일 제약
        # TODO-018: 성능 검증 (1초 이내)
        # TODO-020: 최소 생성 케이스
```

### 파일별 테스트 개수

| 파일 | TODO 개수 | 예상 시간 | 설명 |
|------|----------|-----------|------|
| `monthlyRecurring31st.spec.ts` | 10개 | 1시간 50분 | 핵심 로직 단위 테스트 |
| `monthlyRecurring31stEdgeCases.spec.ts` | 6개 | 1시간 5분 | Edge Case 집중 테스트 |
| `monthlyRecurring31stIntegration.spec.tsx` | 3개 | 30분 | 통합 테스트 (UI 포함) |
| `monthlyRecurringPerformance.spec.ts` | 3개 | 30분 | 성능/제약사항 테스트 |
| **합계** | **22개** | **4시간 15분** | |

---

## 테스트 데이터

### 기본 테스트 데이터

```typescript
// 31일 매월 반복 기본 데이터
const baseEvent31st: EventForm = {
  title: '월말 보고',
  date: '2025-01-31',
  startTime: '09:00',
  endTime: '10:00',
  description: '매월 말일 보고서 제출',
  location: '본사',
  category: '업무',
  repeat: {
    type: 'monthly',
    interval: 1,
    endDate: '2025-12-31',
  },
  notificationTime: 10,
};

// 15일 매월 반복 기본 데이터 (비교용)
const baseEvent15th: EventForm = {
  title: '정기 회의',
  date: '2025-01-15',
  startTime: '14:00',
  endTime: '15:00',
  description: '매월 중순 정기 회의',
  location: '회의실 A',
  category: '업무',
  repeat: {
    type: 'monthly',
    interval: 1,
    endDate: '2025-06-15',
  },
  notificationTime: 10,
};
```

### 월별 예상 생성 결과 (2025년)

| 시작일 | 1월 | 2월 | 3월 | 4월 | 5월 | 6월 | 7월 | 8월 | 9월 | 10월 | 11월 | 12월 | 합계 |
|-------|-----|-----|-----|-----|-----|-----|-----|-----|-----|------|------|------|------|
| 2025-01-31 | ✅ | ❌ | ✅ | ❌ | ✅ | ❌ | ✅ | ✅ | ❌ | ✅ | ❌ | ✅ | 7개 |
| 2025-01-15 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | 12개 |
| 2025-03-31 | - | - | ✅ | ❌ | ✅ | ❌ | ✅ | ✅ | ❌ | ✅ | ❌ | ✅ | 6개 |
| 2025-08-31 | - | - | - | - | - | - | - | ✅ | ❌ | ✅ | ❌ | ✅ | 3개 |

### Edge Case 시나리오별 예상 결과

```typescript
// 시나리오 1: 윤년 2월 건너뛰기
{
  startDate: '2024-01-31',
  endDate: '2024-03-31',
  expectedDates: ['2024-01-31', '2024-03-31'],
  skippedDates: ['2024-02-31'], // 윤년이지만 2월은 29일까지
}

// 시나리오 2: 연속 건너뛰기 (4-6월)
{
  startDate: '2025-03-31',
  endDate: '2025-07-31',
  expectedDates: ['2025-03-31', '2025-05-31', '2025-07-31'],
  skippedDates: ['2025-04-31', '2025-06-31'],
}

// 시나리오 3: 연말 경계
{
  startDate: '2024-12-31',
  endDate: '2025-03-31',
  expectedDates: ['2024-12-31', '2025-01-31', '2025-03-31'],
  skippedDates: ['2025-02-31'],
}

// 시나리오 4: 최소 생성 (1개)
{
  startDate: '2025-12-31',
  endDate: '2025-12-31',
  expectedDates: ['2025-12-31'],
  skippedDates: [],
}

// 시나리오 5: 1년 전체
{
  startDate: '2025-01-31',
  endDate: '2025-12-31',
  expectedDates: [
    '2025-01-31',
    '2025-03-31',
    '2025-05-31',
    '2025-07-31',
    '2025-08-31',
    '2025-10-31',
    '2025-12-31',
  ],
  skippedDates: [
    '2025-02-31',
    '2025-04-31',
    '2025-06-31',
    '2025-09-31',
    '2025-11-31',
  ],
}
```

---

## 예상 구현 함수 시그니처

테스트 구현 시 필요할 것으로 예상되는 함수들:

```typescript
/**
 * 매월 반복 일정 생성
 * @param eventForm - 이벤트 폼 데이터
 * @returns 생성된 반복 이벤트 배열
 */
function generateMonthlyRecurringEvents(eventForm: EventForm): Event[];

/**
 * 특정 날짜에 해당 일(day)이 있는지 확인
 * @param year - 연도
 * @param month - 월 (1-12)
 * @param day - 일 (1-31)
 * @returns 해당 일이 존재하면 true
 */
function isValidDayInMonth(year: number, month: number, day: number): boolean;

/**
 * 다음 유효한 월간 반복 날짜 계산
 * @param currentDate - 현재 날짜
 * @param dayOfMonth - 반복할 일(day) (예: 31)
 * @returns 다음 유효한 날짜 또는 null
 */
function getNextMonthlyOccurrence(
  currentDate: Date,
  dayOfMonth: number
): Date | null;

/**
 * 31일이 있는 달인지 확인
 * @param month - 월 (1-12)
 * @returns 31일이 있으면 true
 */
function hasDay31(month: number): boolean;

/**
 * 윤년 판정
 * @param year - 연도
 * @returns 윤년이면 true
 */
function isLeapYear(year: number): boolean;

/**
 * 특정 월의 마지막 날 계산
 * @param year - 연도
 * @param month - 월 (1-12)
 * @returns 해당 월의 마지막 일 (28, 29, 30, 31)
 */
function getLastDayOfMonth(year: number, month: number): number;
```

---

## 구현 시 주의사항

### 1. 날짜 계산 정확성

- JavaScript Date 객체의 월은 0-based (0=1월, 11=12월)
- 31일을 직접 설정하면 자동으로 다음 달로 넘어가는 경우 주의
- `new Date(2025, 1, 31)` → `2025-03-03` (2월 31일 → 3월 3일로 변환됨)

**권장 방식**:
```typescript
// Bad: 자동 변환 발생
const date = new Date(2025, 1, 31); // 3월 3일이 됨

// Good: 해당 월의 마지막 날 확인 후 생성
const lastDay = new Date(2025, 2, 0).getDate(); // 2월 마지막 날 = 28
if (lastDay >= 31) {
  const date = new Date(2025, 1, 31);
}
```

### 2. 윤년 판정 로직

```typescript
function isLeapYear(year: number): boolean {
  return (year % 4 === 0 && year % 100 !== 0) || year % 400 === 0;
}
```

### 3. 31일 있는 달 확인

```typescript
const MONTHS_WITH_31_DAYS = [1, 3, 5, 7, 8, 10, 12]; // 1월, 3월, 5월, 7월, 8월, 10월, 12월

function hasDay31(month: number): boolean {
  return MONTHS_WITH_31_DAYS.includes(month);
}
```

### 4. 종료일 제약 (2025-12-31)

```typescript
const MAX_END_DATE = new Date('2025-12-31');

function isWithinMaxEndDate(date: Date): boolean {
  return date <= MAX_END_DATE;
}
```

### 5. 성능 고려사항

- 매월 반복의 경우 최대 12개/년 생성
- 31일 반복의 경우 최대 7개/년 생성
- 루프 최적화: 31일 없는 달은 즉시 건너뛰기

```typescript
// 최적화 예시
for (let month = startMonth; month <= endMonth; month++) {
  if (!hasDay31(month)) continue; // 즉시 건너뛰기

  // 31일 있는 달만 처리
  const date = new Date(year, month - 1, 31);
  events.push(createEvent(date));
}
```

---

## 관련 요구사항 및 의존성

### 선행 요구사항 (테스트 전 구현 필요)

| REQ ID | 설명 | 이유 |
|--------|------|------|
| REQ-001 | 반복 유형 선택 | 매월 반복 선택 UI 필요 |
| - | 기본 이벤트 생성 | 단일 이벤트 생성이 동작해야 반복 생성 테스트 가능 |

### 후속 요구사항 (REQ-002 이후 테스트)

| REQ ID | 설명 | 관계 |
|--------|------|------|
| REQ-003 | 윤년 2월 29일 매년 반복 | 유사한 Edge Case, 날짜 로직 재사용 가능 |
| REQ-005 | 반복 아이콘 표시 | 31일 반복 일정에도 아이콘 표시 필요 |
| REQ-006 | 반복 종료 조건 | 종료일 설정 UI 필요 |
| REQ-007 | 단일 수정 | 31일 반복 일정 중 하나만 수정 |
| REQ-008 | 전체 수정 | 31일 반복 일정 전체 수정 |
| REQ-009 | 단일 삭제 | 31일 반복 일정 중 하나만 삭제 |
| REQ-010 | 전체 삭제 | 31일 반복 일정 전체 삭제 |

---

## 테스트 전략

### 1. Bottom-Up 접근

```
Level 1: 유틸 함수 테스트
  ├─ hasDay31()
  ├─ isLeapYear()
  └─ getLastDayOfMonth()
       ↓
Level 2: 단일 월 생성 테스트
  ├─ TODO-002: 3개월
  ├─ TODO-003: 1개월
  └─ TODO-004: 2월 건너뛰기
       ↓
Level 3: 다중 월 생성 테스트
  ├─ TODO-005: 7개월 전체
  ├─ TODO-006: 30일 달 건너뛰기
  └─ TODO-007: 모든 건너뛰는 달
       ↓
Level 4: Edge Case 테스트
  ├─ TODO-011: 윤년
  ├─ TODO-012: 평년
  └─ TODO-013: 연말 경계
       ↓
Level 5: 통합 테스트
  └─ TODO-019: 1년 전체
```

### 2. Red-Green-Refactor 적용

**Red (TODO-001)**:
```typescript
it('매월 반복 기본 로직 검증 (15일)', () => {
  const events = generateMonthlyRecurringEvents({
    date: '2025-01-15',
    repeat: { type: 'monthly', interval: 1, endDate: '2025-04-15' },
    // ...
  });

  expect(events).toHaveLength(4); // FAIL - 아직 구현 안 됨
});
```

**Green (최소 구현)**:
```typescript
function generateMonthlyRecurringEvents(eventForm: EventForm): Event[] {
  // 일단 하드코딩으로 통과
  return [
    { ...eventForm, date: '2025-01-15', id: '1' },
    { ...eventForm, date: '2025-02-15', id: '2' },
    { ...eventForm, date: '2025-03-15', id: '3' },
    { ...eventForm, date: '2025-04-15', id: '4' },
  ];
}
```

**Red (TODO-002 - Triangulation)**:
```typescript
it('31일 매월 반복 - 1월 시작 3개월', () => {
  const events = generateMonthlyRecurringEvents({
    date: '2025-01-31',
    repeat: { type: 'monthly', interval: 1, endDate: '2025-05-31' },
    // ...
  });

  expect(events).toHaveLength(3); // FAIL - 하드코딩으로는 안 됨
  expect(events[0].date).toBe('2025-01-31');
  expect(events[1].date).toBe('2025-03-31'); // 2월 건너뜀
  expect(events[2].date).toBe('2025-05-31'); // 4월 건너뜀
});
```

**Refactor (일반화)**:
```typescript
function generateMonthlyRecurringEvents(eventForm: EventForm): Event[] {
  const events: Event[] = [];
  const startDate = new Date(eventForm.date);
  const endDate = new Date(eventForm.repeat.endDate || MAX_END_DATE);
  const dayOfMonth = startDate.getDate();

  let currentDate = new Date(startDate);

  while (currentDate <= endDate) {
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth() + 1;

    // 해당 월에 dayOfMonth가 존재하는지 확인
    if (isValidDayInMonth(year, month, dayOfMonth)) {
      events.push({
        ...eventForm,
        date: formatDate(currentDate),
        id: generateId(),
      });
    }

    // 다음 달로 이동
    currentDate.setMonth(currentDate.getMonth() + 1);
  }

  return events;
}
```

### 3. Baby Steps 예시

**Step 1** (10분): TODO-001 - 15일 매월 반복 (모든 달 가능) → 기본 로직 확인

**Step 2** (15분): TODO-002 - 31일 3개월 (1, 3, 5월) → 31일 케이스 도입

**Step 3** (10분): TODO-003 - 31일 1개만 → 건너뛰기 동작 확인

**Step 4** (10분): TODO-004 - 2월 명시 확인 → 2월 특수 처리

**Step 5** (20분): TODO-005 - 7개월 전체 → 모든 31일 달 확인

**Step 6** (15분): TODO-006 - 30일 달 건너뛰기 → 4, 6, 9, 11월 처리

**중간 Refactor**: 중복 제거, hasDay31() 유틸 함수 추출

**Step 7** (15분): TODO-007 - 모든 건너뛰는 달 검증 → 통합 확인

---

## 완료 조건

이 테스트 설계가 완료되었다고 판단하는 기준:

### ✅ 체크리스트

- [ ] 명세 REQ-002의 모든 요구사항이 TODO로 변환됨
- [ ] EDGE-001의 모든 시나리오가 커버됨
- [ ] 31일이 있는 7개 달 모두 테스트됨
- [ ] 31일이 없는 5개 달 건너뛰기 모두 테스트됨
- [ ] 윤년/평년 2월 처리가 포함됨
- [ ] 최대 종료일(2025-12-31) 제약이 테스트됨
- [ ] 성능 요구사항(1초, 365개)이 확인됨
- [ ] 통합 테스트(1년 전체)가 포함됨
- [ ] 각 TODO가 5~20분 크기로 분할됨
- [ ] TODO 순서가 간단한 것부터 복잡한 순서임
- [ ] Coverage Map이 100%임

### 승인 후 다음 단계

1. **사용자 승인 대기**: 불명확한 항목 확인
2. **구현 시작**: `test-code-implementer` 에이전트 호출
3. **구현 순서**: TODO-001부터 순차 진행
4. **리뷰 포인트**: TODO-010, TODO-016, TODO-022 완료 시점

---

## 추가 참고사항

### 월별 일수 계산 로직 예시

```typescript
function getDaysInMonth(year: number, month: number): number {
  // month: 1-12
  return new Date(year, month, 0).getDate();
}

// 사용 예시
getDaysInMonth(2025, 1); // 31 (1월)
getDaysInMonth(2025, 2); // 28 (2월, 평년)
getDaysInMonth(2024, 2); // 29 (2월, 윤년)
getDaysInMonth(2025, 4); // 30 (4월)
```

### 월간 반복 알고리즘 슈도코드

```
function generateMonthlyRecurringEvents(eventForm):
  events = []
  startDate = parse(eventForm.date)
  endDate = parse(eventForm.repeat.endDate) OR MAX_END_DATE
  dayOfMonth = startDate.day

  currentDate = startDate

  while currentDate <= endDate AND currentDate <= MAX_END_DATE:
    year = currentDate.year
    month = currentDate.month

    # 해당 월에 dayOfMonth가 존재하는지 확인
    lastDayOfMonth = getDaysInMonth(year, month)

    if dayOfMonth <= lastDayOfMonth:
      # 유효한 날짜이므로 이벤트 생성
      event = createEvent({
        ...eventForm,
        date: formatDate(year, month, dayOfMonth),
        id: generateUniqueId()
      })
      events.push(event)
    else:
      # 해당 월에 dayOfMonth가 없으므로 건너뛰기
      # 예: 31일이지만 4월은 30일까지 → 건너뛰기
      skip

    # 다음 달로 이동
    currentDate = addMonths(currentDate, 1)

  return events
```

---

## 문서 버전 히스토리

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| 1.0 | 2025-01-30 | 초안 작성 - REQ-002 테스트 설계 완료 | Test Planner Agent |

---

## 승인 및 피드백

### 승인 절차

1. **설계 검토**: 이 문서를 검토하여 빠진 케이스가 없는지 확인
2. **불명확한 항목 해결**: "⚠️ 불명확한 항목" 섹션의 질문에 답변
3. **승인**: "OK" 또는 "구현 시작" 답변
4. **구현 단계 진행**: `test-code-implementer` 에이전트가 TODO 기반으로 구현

### 수정 요청 시

- **형식**: "TODO-XXX 수정 필요: [이유]"
- **예시**: "TODO-005에 8월도 명시적으로 확인하는 검증 항목 추가 필요"

---

**설계 완료. 사용자 승인 대기 중입니다.**

검토 후 피드백 부탁드립니다. 👍
